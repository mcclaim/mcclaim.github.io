function detect_old_ie(){if(!/MSIE (\d+\.\d+);/.test(navigator.userAgent))return!1;var o=new Number(RegExp.$1);return!(o>=9)&&(o>=8||(o>=7||(o>=6||(o>=5||void 0))))}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(o){window.setTimeout(o,20)},function(o){function t(t,e){function i(){var o=document.documentElement;return{left:(window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),top:(window.pageYOffset||o.scrollTop)-(o.clientTop||0)}}function s(){var e=t.offset();if(m="auto"==co.options.zoomWidth?ao:co.options.zoomWidth,g="auto"==co.options.zoomHeight?po:co.options.zoomHeight,"#"==co.options.position.substr(0,1)?ho=o(co.options.position):ho.length=0,0!=ho.length)return!0;switch(lo){case"lens":case"inside":return!0;case"top":x=e.top,b=e.left,z=x-g,y=b;break;case"left":x=e.top,b=e.left,z=x,y=b-m;break;case"bottom":x=e.top,b=e.left,z=x+po,y=b;break;case"right":default:x=e.top,b=e.left,z=x,y=b+ao}return!(y+m>eo||y<0)}function n(){if("circle"==co.options.lensShape&&"lens"==co.options.position){var o=((q=E=Math.max(q,E))+2*Math.max(_,Z))/2;Y.css({"-moz-border-radius":o,"-webkit-border-radius":o,"border-radius":o})}}function a(o,t,e,i){"lens"==co.options.position?(X.css({top:-(t-x)*N+E/2,left:-(o-b)*j+q/2}),co.options.bg&&(Y.css({"background-image":"url("+X.attr("src")+")","background-repeat":"no-repeat","background-position":-(o-b)*j+q/2+"px "+(-(t-x)*N+E/2)+"px"}),e&&i&&Y.css({"background-size":e+"px "+i+"px"}))):X.css({top:-D*N,left:-L*j})}function p(o,t){if(mo<-1&&(mo=-1),mo>1&&(mo=1),Q<$)var e=(s=m*(i=Q-(Q-1)*mo))/B;else var i=$-($-1)*mo,s=(e=g*i)*B;K?(go=o,wo=t,xo=s,bo=e):(K||(zo=xo=s,yo=bo=e),q=m/(j=s/u),E=g/(N=e/v),n(),r(o,t),X.width(s),X.height(e),Y.width(q),Y.height(E),Y.css({top:D-_,left:L-Z}),R.css({top:-D,left:-L}),a(o,t,s,e))}function l(){var o=Co,t=ko,e=Oo,i=Mo,s=zo,p=yo;o+=(go-o)/co.options.smoothLensMove,t+=(wo-t)/co.options.smoothLensMove,e+=(go-e)/co.options.smoothZoomMove,i+=(wo-i)/co.options.smoothZoomMove,s+=(xo-s)/co.options.smoothScale,p+=(bo-p)/co.options.smoothScale,q=m/(j=s/u),E=g/(N=p/v),n(),r(o,t),X.width(s),X.height(p),Y.width(q),Y.height(E),Y.css({top:D-_,left:L-Z}),R.css({top:-D,left:-L}),r(e,i),a(o,t,s,p),Co=o,ko=t,Oo=e,Mo=i,zo=s,yo=p,K&&requestAnimFrame(l)}function r(o,t){L=(o-=b)-q/2,D=(t-=x)-E/2,"lens"!=co.options.position&&co.options.lensCollision&&(L<0&&(L=0),L>u-q&&(L=u-q),D<0&&(D=0),D>v-E&&(D=v-E))}function d(){void 0!==A&&A.remove(),void 0!==W&&W.remove(),void 0!==to&&to.remove()}function c(e,s){switch("fullscreen"==co.options.position?(u=o(window).width(),v=o(window).height()):(u=t.width(),v=t.height()),F.css({top:v/2-F.height()/2,left:u/2-F.width()/2}),w=co.options.rootOutput||"fullscreen"==co.options.position?t.offset():t.position(),w.top=Math.round(w.top),w.left=Math.round(w.left),co.options.position){case"fullscreen":x=i().top,b=i().left,z=0,y=0;break;case"inside":x=w.top,b=w.left,z=0,y=0;break;case"top":x=w.top,b=w.left,z=x-g,y=b;break;case"left":x=w.top,b=w.left,z=x,y=b-m;break;case"bottom":x=w.top,b=w.left,z=x+v,y=b;break;case"right":default:x=w.top,b=w.left,z=x,y=b+u}x-=A.outerHeight()/2,b-=A.outerWidth()/2,"#"==co.options.position.substr(0,1)?ho=o(co.options.position):ho.length=0,0==ho.length&&"inside"!=co.options.position&&"fullscreen"!=co.options.position?(co.options.adaptive&&so&&no||(so=u,no=v),m="auto"==co.options.zoomWidth?u:co.options.zoomWidth,g="auto"==co.options.zoomHeight?v:co.options.zoomHeight,z+=co.options.Yoffset,y+=co.options.Xoffset,W.css({width:m+"px",height:g+"px",top:z,left:y}),"lens"!=co.options.position&&f.append(W)):"inside"==co.options.position||"fullscreen"==co.options.position?(m=u,g=v,W.css({width:m+"px",height:g+"px"}),A.append(W)):(m=ho.width(),g=ho.height(),co.options.rootOutput?(z=ho.offset().top,y=ho.offset().left,f.append(W)):(z=ho.position().top,y=ho.position().left,ho.parent().append(W)),z+=(ho.outerHeight()-g-W.outerHeight())/2,y+=(ho.outerWidth()-m-W.outerWidth())/2,W.css({width:m+"px",height:g+"px",top:z,left:y})),co.options.title&&""!=Wo&&("inside"==co.options.position||"lens"==co.options.position||"fullscreen"==co.options.position?(C=z,k=y,A.append(to)):(C=z+(W.outerHeight()-g)/2,k=y+(W.outerWidth()-m)/2,f.append(to)),to.css({width:m+"px",height:g+"px",top:C,left:k})),A.css({width:u+"px",height:v+"px",top:x,left:b}),H.css({width:u+"px",height:v+"px"}),co.options.tint&&"inside"!=co.options.position&&"fullscreen"!=co.options.position?H.css("background-color",co.options.tint):Ao&&H.css({"background-image":"url("+t.attr("src")+")","background-color":"#fff"}),T=new Image;var n="";switch(Ho&&(n="?r="+(new Date).getTime()),T.src=t.attr("xoriginal")+n,(X=o(T)).css("position","absolute"),T=new Image,T.src=t.attr("src"),(R=o(T)).css("position","absolute"),R.width(u),co.options.position){case"fullscreen":case"inside":W.append(X);break;case"lens":Y.append(X),co.options.bg&&X.css({display:"none"});break;default:W.append(X),Y.append(R)}}function h(o){var t=o.attr("title"),e=o.attr("xtitle");return e||(t||"")}this.xzoom=!0;var f,u,v,m,g,w,x,b,z,y,C,k,O,M,A,H,W,F,I,S,T,X,Y,R,q,E,L,D,Z,_,j,N,Q,$,B,G,J,K,P,U,V,oo,to,eo,io,so,no,ao,po,lo,ro,co=this,ho={},fo=(new Array,new Array),uo=0,vo=0,mo=0,go=0,wo=0,xo=0,bo=0,zo=0,yo=0,Co=0,ko=0,Oo=0,Mo=0,Ao=detect_old_ie(),Ho=/MSIE (\d+\.\d+);/.test(navigator.userAgent),Wo="";this.adaptive=function(){0!=so&&0!=no||(t.css("width",""),t.css("height",""),so=t.width(),no=t.height()),d(),eo=o(window).width(),io=o(window).height(),ao=t.width(),po=t.height();var e=!1;(so>eo||no>io)&&(e=!0),ao>so&&(ao=so),po>no&&(po=no),e?t.width("100%"):0!=so&&t.width(so),"fullscreen"!=lo&&(s()?co.options.position=lo:co.options.position=co.options.mposition),co.options.lensReverse||(ro=co.options.adaptiveReverse&&co.options.position==co.options.mposition)},this.xscroll=function(o){if(O=o.pageX||o.originalEvent.pageX,M=o.pageY||o.originalEvent.pageY,o.preventDefault(),o.xscale)mo=o.xscale,p(O,M);else{var t=-o.originalEvent.detail||o.originalEvent.wheelDelta||o.xdelta,e=O,i=M;Ao&&(e=P,i=U),mo+=t=t>0?-.05:.05,p(e,i)}},this.openzoom=function(t){switch(O=t.pageX,M=t.pageY,co.options.adaptive&&co.adaptive(),mo=co.options.defaultScale,K=!1,A=o("<div></div>"),""!=co.options.sourceClass&&A.addClass(co.options.sourceClass),A.css("position","absolute"),F=o("<div></div>"),""!=co.options.loadingClass&&F.addClass(co.options.loadingClass),F.css("position","absolute"),H=o('<div style="position: absolute; top: 0; left: 0;"></div>'),A.append(F),W=o("<div></div>"),""!=co.options.zoomClass&&"fullscreen"!=co.options.position&&W.addClass(co.options.zoomClass),W.css({position:"absolute",overflow:"hidden",opacity:1}),co.options.title&&""!=Wo&&(to=o("<div></div>"),oo=o("<div></div>"),to.css({position:"absolute",opacity:1}),co.options.titleClass&&oo.addClass(co.options.titleClass),oo.html("<span>"+Wo+"</span>"),to.append(oo),co.options.fadeIn&&to.css({opacity:0})),Y=o("<div></div>"),""!=co.options.lensClass&&Y.addClass(co.options.lensClass),Y.css({position:"absolute",overflow:"hidden"}),co.options.lens&&(lenstint=o("<div></div>"),lenstint.css({position:"absolute",background:co.options.lens,opacity:co.options.lensOpacity,width:"100%",height:"100%",top:0,left:0,"z-index":9999}),Y.append(lenstint)),"inside"!=co.options.position&&"fullscreen"!=co.options.position?((co.options.tint||Ao)&&A.append(H),co.options.fadeIn&&(H.css({opacity:0}),Y.css({opacity:0}),W.css({opacity:0})),f.append(A)):(co.options.fadeIn&&W.css({opacity:0}),f.append(A)),co.eventmove(A),co.eventleave(A),c(),co.options.position){case"inside":z-=(W.outerHeight()-W.height())/2,y-=(W.outerWidth()-W.width())/2;break;case"top":z-=W.outerHeight()-W.height(),y-=(W.outerWidth()-W.width())/2;break;case"left":z-=(W.outerHeight()-W.height())/2,y-=W.outerWidth()-W.width();break;case"bottom":y-=(W.outerWidth()-W.width())/2;break;case"right":z-=(W.outerHeight()-W.height())/2}W.css({top:z,left:y}),X.xon("load",function(){F.remove(),co.options.scroll&&co.eventscroll(A),"inside"!=co.options.position&&"fullscreen"!=co.options.position?(A.append(Y),co.options.fadeIn?(H.fadeTo(300,co.options.tintOpacity),Y.fadeTo(300,1),W.fadeTo(300,1)):(H.css({opacity:co.options.tintOpacity}),Y.css({opacity:1}),W.css({opacity:1}))):co.options.fadeIn?W.fadeTo(300,1):W.css({opacity:1}),co.options.title&&""!=Wo&&(co.options.fadeIn?to.fadeTo(300,1):to.css({opacity:1})),G=X.width(),J=X.height(),co.options.adaptive&&(u<so||v<no)&&(R.width(u),R.height(v),G*=u/so,J*=v/no,X.width(G),X.height(J)),zo=xo=G,yo=bo=J,B=G/J,Q=G/m,$=J/g;var o,t=["padding-","border-"];_=Z=0;for(var e=0;e<t.length;e++)o=parseFloat(Y.css(t[e]+"top-width")),_+=o!==o?0:o,o=parseFloat(Y.css(t[e]+"bottom-width")),_+=o!==o?0:o,o=parseFloat(Y.css(t[e]+"left-width")),Z+=o!==o?0:o,o=parseFloat(Y.css(t[e]+"right-width")),Z+=o!==o?0:o;_/=2,Z/=2,Oo=Co=go=O,Mo=ko=wo=M,p(O,M),co.options.smooth&&(K=!0,requestAnimFrame(l)),co.eventclick(A)})},this.movezoom=function(o){O=o.pageX,M=o.pageY,Ao&&(P=O,U=M);var t=O-b,e=M-x;ro&&(o.pageX-=2*(t-u/2),o.pageY-=2*(e-v/2)),(t<0||t>u||e<0||e>v)&&A.trigger("mouseleave"),co.options.smooth?(go=o.pageX,wo=o.pageY):(n(),r(o.pageX,o.pageY),Y.css({top:D-_,left:L-Z}),R.css({top:-D,left:-L}),a(o.pageX,o.pageY,0,0))},this.eventdefault=function(){co.eventopen=function(o){o.xon("mouseenter",co.openzoom)},co.eventleave=function(o){o.xon("mouseleave",co.closezoom)},co.eventmove=function(o){o.xon("mousemove",co.movezoom)},co.eventscroll=function(o){o.xon("mousewheel DOMMouseScroll",co.xscroll)},co.eventclick=function(o){o.xon("click",function(o){t.trigger("click")})}},this.eventunbind=function(){t.xoff("mouseenter"),co.eventopen=function(o){},co.eventleave=function(o){},co.eventmove=function(o){},co.eventscroll=function(o){},co.eventclick=function(o){}},this.init=function(e){co.options=o.extend({},o.fn.xzoom.defaults,e),f=co.options.rootOutput?o("body"):t.parent(),lo=co.options.position,ro=co.options.lensReverse&&"inside"==co.options.position,co.options.smoothZoomMove<1&&(co.options.smoothZoomMove=1),co.options.smoothLensMove<1&&(co.options.smoothLensMove=1),co.options.smoothScale<1&&(co.options.smoothScale=1),co.options.adaptive&&o(window).xon("load",function(){so=t.width(),no=t.height(),co.adaptive(),o(window).resize(co.adaptive)}),co.eventdefault(),co.eventopen(t)},this.destroy=function(){co.eventunbind()},this.closezoom=function(){K=!1,co.options.fadeOut?(co.options.title&&""!=Wo&&to.fadeOut(299),"inside"!=co.options.position||"fullscreen"!=co.options.position?(W.fadeOut(299),A.fadeOut(300,function(){d()})):A.fadeOut(300,function(){d()})):d()},this.gallery=function(){var o,t=new Array,e=0;for(o=vo;o<fo.length;o++)t[e]=fo[o],e++;for(o=0;o<vo;o++)t[e]=fo[o],e++;return{index:vo,ogallery:fo,cgallery:t}},this.xappend=function(e){function i(i){d(),i.preventDefault(),co.options.activeClass&&(V.removeClass(co.options.activeClass),(V=e).addClass(co.options.activeClass)),vo=o(this).data("xindex"),co.options.fadeTrans&&((S=new Image).src=t.attr("src"),(I=o(S)).css({position:"absolute",top:t.offset().top,left:t.offset().left,width:t.width(),height:t.height()}),o(document.body).append(I),I.fadeOut(200,function(){I.remove()}));var n=s.attr("href"),a=e.attr("xpreview")||e.attr("src");Wo=h(e),e.attr("title")&&t.attr("title",e.attr("title")),t.attr("xoriginal",n),t.removeAttr("style"),t.attr("src",a),co.options.adaptive&&(so=t.width(),no=t.height())}var s=e.parent();fo[uo]=s.attr("href"),s.data("xindex",uo),0==uo&&co.options.activeClass&&(V=e).addClass(co.options.activeClass),0==uo&&co.options.title&&(Wo=h(e)),uo++,co.options.hover&&s.xon("mouseenter",s,i),s.xon("click",s,i)},this.init(e)}o.fn.xon=o.fn.on||o.fn.bind,o.fn.xoff=o.fn.off||o.fn.bind,o.fn.xzoom=function(e){var i,s;if(this.selector){var n=this.selector.split(",");for(var a in n)n[a]=o.trim(n[a]);this.each(function(a){if(1==n.length)if(0==a){if(void 0!==(i=o(this)).data("xzoom"))return i.data("xzoom");i.x=new t(i,e)}else void 0!==i.x&&(s=o(this),i.x.xappend(s));else if(o(this).is(n[0])&&0==a){if(void 0!==(i=o(this)).data("xzoom"))return i.data("xzoom");i.x=new t(i,e)}else void 0===i.x||o(this).is(n[0])||(s=o(this),i.x.xappend(s))})}else this.each(function(n){if(0==n){if(void 0!==(i=o(this)).data("xzoom"))return i.data("xzoom");i.x=new t(i,e)}else void 0!==i.x&&(s=o(this),i.x.xappend(s))});return void 0!==i&&(i.data("xzoom",i.x),o(i).trigger("xzoom_ready"),i.x)},o.fn.xzoom.defaults={position:"right",mposition:"inside",rootOutput:!0,Xoffset:0,Yoffset:0,fadeIn:!0,fadeTrans:!0,fadeOut:!1,smooth:!0,smoothZoomMove:3,smoothLensMove:1,smoothScale:6,defaultScale:0,scroll:!0,tint:!1,tintOpacity:.5,lens:!1,lensOpacity:.5,lensShape:"box",zoomWidth:"auto",zoomHeight:"auto",sourceClass:"xzoom-source",loadingClass:"xzoom-loading",lensClass:"xzoom-lens",zoomClass:"xzoom-preview",activeClass:"xactive",hover:!1,adaptive:!0,lensReverse:!1,lensCollision:!0,adaptiveReverse:!1,title:!1,titleClass:"xzoom-caption",bg:!1}}(jQuery);